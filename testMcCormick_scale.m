%% test McCormick
x1=sdpvar(1,1,'full');
x2=sdpvar(1,1,'full');
x3=sdpvar(1,1,'full');
x4=sdpvar(1,1,'full');
P1=sdpvar(1,1,'full');
P2=sdpvar(1,1,'full');
W=sdpvar(1,1,'full');
Y=sdpvar(1,1,'full');
Rprop=sdpvar(1,1,'full');
F0=[];
F=[];
F0=F0+(0<=x1<=10);
F0=F0+(0<=x2<=30);
F0=F0+(0<=x3<=70);
F0=F0+(0<=x4<=20);
F0=F0+(Y==x2+x3);
X=sdpvar(1,1,'full');
XL=45;
XU=120;
YL=0;
YU=999;
F0=F0+(W+Rprop==x2*56+x3*78);
F=F+(W>=XL*Y+X*YL-XL*YL);
F=F+(W>=XU*Y+X*YU-XU*YU);
F=F+(W<=XU*Y+X*YL-XU*YL);
F=F+(W<=XL*Y+X*YU-XL*YU);
x11=sdpvar(1,1,'full');
x12=sdpvar(1,1,'full');
Y1=sdpvar(1,1,'full');
Y2=sdpvar(1,1,'full');
x41=sdpvar(1,1,'full');
x42=sdpvar(1,1,'full');
F0=F0+(x11>=0);
F0=F0+(x12>=0);
F0=F0+(Y1>=0);
F0=F0+(Y2>=0);
F0=F0+(x41>=0);
F0=F0+(x42>=0);
F0=F0+(Y1>=0);
F0=F0+(Y2>=0);
F0=F0+(x1==x11+x12);
F0=F0+(x4==x41+x42);
F0=F0+(Y==Y1+Y2);
F0=F0+(P1==x11+x41+Y1);
F0=F0+(P2==x12+x42+Y2);
RP1=sdpvar(1,1,'full');
RP2=sdpvar(1,1,'full');
W1=sdpvar(1,1,'full');
W2=sdpvar(1,1,'full');
F0=F0+(RP1==45*x11+98*x41+W1);
F0=F0+(RP2==45*x12+98*x42+W2);
R1=sdpvar(1,1,'full');
R2=sdpvar(1,1,'full');
F0=F0+(RP1>=70*P1);
F0=F0+(RP2>=85*P2);
WL=0;
WU=30*56+78*70;
RL=0;
RU=1;
F=F+(Y1>=YL*R1+Y*RL-YL*RL);
F=F+(Y1>=YU*R1+Y*RU-YU*RU);
F=F+(Y1<=YU*R1+Y*RL-YU*RL);
F=F+(Y1<=Y*RU+YL*R1-YL*RU);
F=F+(Y2>=YL*R2+Y*RL-YL*RL);
F=F+(Y2>=YU*R2+Y*RU-YU*RU);
F=F+(Y2<=YU*R2+Y*RL-YU*RL);
F=F+(Y2<=Y*RU+YL*R2-YL*RU);
F=F+(W1>=WL*R1+W*RL-WL*RL);
F=F+(W1>=WU*R1+W*RU-WU*RU);
F=F+(W1<=WU*R1+W*RL-WU*RL);
F=F+(W1<=W*RU+WL*R1-WL*RU);
F=F+(W2>=WL*R2+W*RL-WL*RL);
F=F+(W2>=WU*R2+W*RU-WU*RU);
F=F+(W2<=WU*R2+W*RL-WU*RL);
F=F+(W2<=W*RU+WL*R2-WL*RU);
F=F+(R1+R2==1);
F=F+(R1>=0);
F=F+(R2>=0);
F=F+(W1>=XL*Y1+X*YL-XL*YL);
F=F+(W1>=XU*Y1+X*YU-XU*YU);
F=F+(W1<=XU*Y1+X*YL-XU*YL);
F=F+(W1<=X*YU+XL*Y1-XL*YU);
F=F+(W2>=XL*Y2+X*YL-XL*YL);
F=F+(W2>=XU*Y2+X*YU-XU*YU);
F=F+(W2<=XU*Y2+X*YL-XU*YL);
F=F+(W2<=X*YU+XL*Y2-XL*YU);
F0=F0+(W==W1+W2);
F=F+(W1>=XL*Y1+X*YL-XL*YL);
F=F+(W1>=XU*Y1+X*YU-XU*YU);
F=F+(W1<=XU*Y1+X*YL-XU*YL);
F=F+(W1<=XL*Y1+X*YU-XL*YU);
F=F+(W2>=XL*Y2+X*YL-XL*YL);
F=F+(W2>=XU*Y2+X*YU-XU*YU);
F=F+(W2<=XU*Y2+X*YL-XU*YL);
F=F+(W2<=XL*Y2+X*YU-XL*YU);

OBJ=-1500*x1-1600*x2-2000*x3-2300*x4+2000*P1+2200*P2;
ops=sdpsettings('solver','cplex');
sol=optimize(F0+F,-OBJ,ops)
[{'x1','x11','x12','x2','x3','x4','x41','x42','P1','P2','X','OBJ','Rprop'};num2cell(value([x1,x11,x12,x2,x3,x4,x41,x42,P1,P2,X,OBJ,Rprop]))]
i=1;
while abs(value(Rprop))>=10^-4
    i=i+1;
    F1=[];
    VX=value(W./Y);
    F1=F1+(W1==VX.*Y1+value(Y1./Y).*Rprop);
    F1=F1+(W2==VX.*Y2+value(Y2./Y).*Rprop);
    F1=F1+(Y1==value(Y1./Y).*Y);
    F1=F1+(Y2==value(Y2./Y).*Y);
    ops=sdpsettings('solver','cplex');
    sol=optimize(F0+F1,-OBJ,ops)
    [{'x1','x11','x12','x2','x3','x4','x41','x42','P1','P2','VX','OBJ','Rprop'};num2cell(value([x1,x11,x12,x2,x3,x4,x41,x42,P1,P2,VX,OBJ,Rprop]))]
end